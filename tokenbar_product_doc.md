# TokenBar 交易页融合产品文档 v2.0

## 文档目录

1. [产品概述](#一产品概述)
2. [设计目标与原则](#二设计目标与原则)
3. [功能架构](#三功能架构)
4. [业务规则与组件逻辑](#四业务规则与组件逻辑)
5. [技术实现要点](#五技术实现要点)
6. [项目里程碑](#六项目里程碑)
7. [附录](#七附录)

---

## 一、产品概述

### 1.1 项目背景

**当前问题：**
- TokenBar 与 SoDEX 交易平台割裂，内容与交易脱节
- 用户在交易时无法便捷获取社区观点和研究分析
- 社区内容在产品中的曝光率低，流量和价值未被充分利用

**解决方案：**
在 SoDEX 交易详情页（https://sodex.com/trade/spot/BTC_USDC）增加 **Community Tab**，将 TokenBar（https://sosovalue.com）的社区内容直接嵌入交易场景，实现"交易中看观点"。

**前期调研文档：**[TokenBar 产品重构调研](https://nkhxy47v6o.sg.larksuite.com/wiki/UdfLwOQEDiQ5nkkJ1snlsRASgmb?from=from_copylink)

### 1.4 Demo 访问方式

当前为纯前端 Demo（Mock 数据），运行方式：

```bash
git clone <repo-url>
git checkout feature/community-tab
cd client
npm install
npm run dev
```

启动后访问 `http://localhost:5173` 即可查看完整 Demo。团队成员 clone 分支后本地运行即可体验，无需后端服务。

### 1.2 核心价值

| 用户角色 | 价值点 |
|---------|--------|
| **普通交易者** | 交易时实时参考专业观点，降低决策盲目性 |
| **认证研究员** | 内容直达目标用户（交易者），提升影响力和关注度 |
| **平台方** | 提高用户停留时长，增强交易决策支持，促进社区生态成长 |

### 1.3 产品定位

**不是：** 完整的社区论坛（那是 TokenBar 的职责）
**而是：** 交易场景下的**轻量级观点流**，提供：
- 快速浏览当前标的相关讨论
- 一键关注优质研究员
- 便捷跳转到详细社区内容

---

## 二、设计目标与原则

### 2.1 设计目标

1. **无缝融入交易场景**：视觉、交互与现有交易页高度统一，不干扰核心交易流程
2. **提升内容消费效率**：用户在 3 秒内判断观点价值，5 秒内完成关注/跳转
3. **促进内容到交易转化**：观点卡片直接关联交易操作，缩短决策路径
4. **建立研究员品牌**：通过账号内容卡片快速建立信任，引导深度关注

### 2.2 设计原则

| 原则 | 说明 | 体现 |
|------|------|------|
| **克制** | 不过度打断交易流程 | 默认折叠，用户主动切换 Tab |
| **高效** | 信息密度高但不过载 | 摘要前置、图片外显、关键数据突出 |
| **一致** | 严格遵循 SoDEX 设计语言 | 色彩、字体、间距、组件样式完全对齐 |
| **渐进** | 浅层预览→深度探索 | 浮层卡片→详情抽屉→完整主页 |

---

## 三、功能架构

### 3.1 整体架构

SoDEX 交易页图表区域顶部有 **Chart / Info / Community** 三个 Tab。点击 Community Tab 后，弹出一个**独立的浮动社区面板**（不替换图表内容，图表始终可见）。

**交易页层级：**

- **图表区域**：顶部 Tab 行 `Chart | Info | Community`
  - Chart Tab（默认）：K 线图、指标、成交量
  - Info Tab：交易对详细信息
  - Community Tab：**不切换图表内容**，而是弹出浮动社区面板
- **交易面板**：Buy/Sell（不受影响）

**Community 浮动面板（450×620px，可拖拽）：**

- **面板头部**（标题"社区" + 关闭按钮，可拖拽移动）
- **左侧垂直导航栏**（图标导航，80px 宽）：
  - 用户头像 → 进入个人主页
  - Home 图标 → 主页（Feed 流）
  - TrendingUp 图标 → 持仓日报
  - Eye 图标 → 我的关注
  - PenSquare 图标 → **发布**（打开 PostEditor 独立浮窗）
- **右侧内容区域**（根据左侧导航切换）：
  - 主页：搜索栏 + 筛选 Tab（编辑精选/最新/最热）+ 新晋研究员轮播 + 帖子列表
  - 持仓日报：持仓卡片 + 代币情绪数据
  - 我的关注：已关注用户的帖子流
  - 个人主页：用户信息 + 帖子列表

### 3.2 信息架构

**内容层级：**

- **Level 1**：交易页图表区顶部 Tab（Chart / Info / Community）
- **Level 2**：浮动社区面板 — 左侧导航 + 右侧内容区
- **Level 3**：主页 Feed 流 — 搜索 + 筛选 Tab + 帖子列表
- **Level 4**：帖子卡片（摘要展示、投票/PK 互动、代币标签）
- **Level 5**：发布编辑器（独立浮窗，z-index 高于社区面板）
- **Level 6**：用户主页（点击头像/昵称进入）

### 3.3 核心交互流程

**浏览流程：**
1. 用户在交易页点击图表区顶部的 **Community** Tab
2. 浮动社区面板弹出（默认位置左上方，450×620px）
3. 面板默认进入**主页**，展示 Feed 流（当前代币相关帖子优先）
4. 用户通过左侧导航切换到持仓日报、我的关注、个人主页
5. 用户可拖拽面板到任意位置，点击关闭按钮或面板外区域关闭

**发布流程：**
1. 用户点击左侧导航的 **发布图标**（PenSquare）
2. PostEditor 以**独立浮窗**弹出（位于面板右侧，z-index 高于社区面板）
3. 用户编辑内容：输入文字、插入表情/图片/视频/话题/图表/投票PK
4. 点击「发表」→ 帖子发布成功，自动插入到 Feed 流顶部，面板切换回主页

**互动流程：**
1. 点赞：点击帖子卡片的点赞按钮，切换状态
2. 关注：点击研究员的关注按钮，全局同步到所有帖子中该用户的关注状态
3. 查看用户主页：点击帖子中的用户头像/昵称，面板内切换到该用户主页

---

## 四、业务规则与组件逻辑

### 4.1 Feed 流排序与分发逻辑

#### 代币关联规则（最高优先级）

- 社区面板接收 `currentSymbol` 参数（来自交易页当前交易对，如 `BTC/USDT`）
- 提取代币符号（如 `BTC`），将 `tags` 中包含该代币的帖子排在最前
- 不包含当前代币的帖子按原排序规则排在后面
- 搜索模式下不应用代币优先排序

#### Feed Tab 排序规则

| Tab | 排序规则 | 代币关联逻辑 |
|-----|---------|-------------|
| **编辑精选** | 按 `likeCount` 降序 | 当前交易代币相关帖子优先排前，其次其他代币 |
| **最热** | 按综合热度（`likeCount + commentCount×2 + shareCount×3`）降序 | 同上，当前代币优先 |
| **最新** | 按 `createdAt` 时间降序 | 同上，当前代币优先 |

### 4.2 导航结构

左侧导航 5 个入口：

| 入口 | 功能说明 |
|------|---------|
| **主页（Home）** | Feed 流 + 搜索栏 + 筛选 Tab + 新晋研究员轮播 |
| **持仓日报（Positions）** | 用户持仓卡片 + 代币情绪数据 |
| **我的关注（Following）** | 仅展示 `isFollowing=true` 的用户帖子，按时间降序；空状态提示"还没有关注任何人" |
| **发布** | 打开 PostEditor 独立浮窗 |
| **头像** | 点击进入自己的个人主页 |

### 4.3 帖子类型与附件组件

| 类型 | 说明 |
|------|------|
| **普通图文** | 文本内容 + 可选图片（最多4张网格展示，超出显示 `+N`） |
| **投票帖 (Poll)** | 多选项投票（2-10个选项），显示各项百分比、总票数、截止时间 |
| **对决帖 (PK)** | 两个选项对决，进度条 + 胶囊按钮，左蓝右橙配色 |
| **长文帖** | 超过200字截断，显示"查看更多" |

**附加元素：**
- **代币标签 (CoinTag)**：关联代币实时行情（价格 + 24h 涨跌幅）
- **话题标签**：`#xxx` 格式，橙色 `#` 前缀

### 4.4 发布编辑器 (PostEditor) 功能

独立可拖拽浮窗，工具栏支持：

| 功能 | 说明 |
|------|------|
| **表情** | 20个常用表情快速插入 |
| **图片** | 支持本地文件多张上传 |
| **视频** | 支持本地文件上传 |
| **话题 (#)** | 推荐热点话题列表（含新闻热点和 Polymarket 热点两类） |
| **数据图表** | 嵌入 SoSoValue 图表（BTC ETF 净流入、ETH ETF 净流入、恐慌贪婪指数） |
| **投票/PK** | 创建投票（2-10个选项）或 PK 对决（2个选项），设置截止日期 |
| **代币自动识别** | 输入内容时自动识别代币符号（BTC、ETH、SOL 等），生成代币标签 |

**发布规则：**
- 2个选项自动识别为 PK 模式，3个以上为投票模式
- 发布后帖子插入列表顶部，自动切换到主页

### 4.5 互动规则

- **点赞**：切换状态，计数 ±1
- **关注/取关**：全局同步——关注某用户后，该用户在所有帖子中的关注状态同步更新
- **评论**：帖子详情页展示评论列表

### 4.6 用户主页规则

- **自己的主页**：隐藏关注按钮，显示 Call 按钮（点击弹出 VIP 提示）
- **他人主页**：显示关注/取关按钮，显示 Call 按钮
- **展示内容**：头像、用户名、认证徽章、关注数、粉丝数、该用户的帖子列表

---

## 五、技术实现要点

### 5.1 技术栈

| 类别 | 技术选型 |
|------|---------|
| **框架** | React 18 + TypeScript |
| **构建工具** | Vite |
| **样式** | Tailwind CSS |
| **状态管理** | Zustand |
| **图标库** | Lucide Icons |
| **路由** | React Router |

### 5.2 关键实现模式

- **Portal 渲染**：社区面板通过 React Portal 渲染到 `document.body`，避免被交易页父容器的 `overflow: hidden` 裁剪
- **拖拽隔离**：面板拖拽使用独立事件监听，与交易页的拖拽操作（如 K 线缩放）互不干扰
- **代币关联**：面板接收 `currentSymbol` prop，实时响应交易对切换
- **全局关注同步**：关注状态使用 Zustand store 全局管理，任意位置的关注/取关操作实时同步到所有可见组件

---

## 六、项目里程碑

### 6.1 当前分支完成状态

**已完成功能：**
- ✅ Community Tab UI 与浮动面板
- ✅ 观点流加载与展示（编辑精选/最新/最热）
- ✅ Feed 流代币关联排序
- ✅ 帖子类型：普通图文、投票、PK、长文
- ✅ 发布编辑器（表情/图片/视频/话题热点/图表/投票PK/代币自动识别）
- ✅ 关注/取消关注功能（全局同步）
- ✅ 用户主页（点击头像/昵称进入）
- ✅ 持仓日报页面
- ✅ 我的关注页面
- ✅ 面板拖拽

**待实现：**
- [ ] 研究员浮层卡片（悬停头像/昵称弹出快速预览）
- [ ] 后端 API 对接（当前使用 Mock 数据）
- [ ] 实时推送（WebSocket）
- [ ] 搜索功能完善
- [ ] 性能优化（虚拟滚动）

---

## 七、附录

### 7.1 术语表

| 术语 | 说明 |
|------|------|
| **TokenBar** | SoSoValue 的社区内容板块 |
| **SoDEX** | 加密货币交易平台 |
| **认证研究员** | 通过平台审核的专业内容创作者 |
| **浮层卡片** | 鼠标悬停时弹出的研究员信息预览 |
| **详情抽屉** | 从右侧滑入的观点完整内容展示面板 |
| **Feed 流** | 社区帖子内容流，支持按不同维度排序和筛选 |
| **PK 帖** | 两个选项对决的投票类型帖子 |

---

## 文档变更记录

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|---------|--------|
| v1.0 | 2026-01-21 | 初始版本 | - |
| v2.0 | 2026-01-27 | 重构文档：删除视觉/交互/埋点设计规范章节，新增业务规则与组件逻辑章节，更新项目里程碑为实际完成状态 | - |

---

**文档状态：** ✅ 已更新
**分支：** `feature/community-tab`
